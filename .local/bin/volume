#!/bin/bash

## mouse input
if [[ $button -eq 1 ]]; then
    pavucontrol > /dev/null &
elif [[ $button -eq 3 ]]; then
    pactl set-sink-mute @DEFAULT_SINK@ toggle
fi

## get sink status
idle_process="$(pgrep swayidle)"
icon="ðŸ”‡"
playing=""
### check if not muted
if [ -n "$(pactl get-sink-mute @DEFAULT_SINK@ | grep no)" ]; then
    playing="$(pactl list sinks | grep 'State: RUNNING')"
    icon="ðŸŽµ"
fi

## manage swayidle
if [ -n "$idle_process" ] && [ -n "$playing" ]; then
    kill -9 "$idle_process"
elif [ -z "$idle_process" ] && [ -z "$playing" ]; then
    idle-command >/dev/null 2>&1 &
fi

echo "$icon" "$(pactl get-sink-volume @DEFAULT_SINK@ | tr -s ' ' | cut -d' ' -f 5 | tr -d '%')"
