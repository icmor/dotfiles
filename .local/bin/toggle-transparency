#!/bin/bash

transparency_process="$(ps aux | grep inactive-transparency | grep -v grep)"
if [ -n "$transparency_process" ]; then
    kill -9 "$(echo "$transparency_process" | tr -s ' ' | cut -d' ' -f2)"
    swaymsg -t get_tree | jq -r '.. |
    select(.type? == "con" and .id? and (.app_id != null or
    (.window_properties? // {} | .class != null))) |
    .id' | while read -r id; do
	swaymsg "[con_id=$id]" opacity 1
    done
else
    inactive-transparency >/dev/null 2>&1 &
fi
